---
description: Reglas cr√≠ticas para el Sistema de Control de Gas - Arquitectura y flujo operativo
globs: app/**/*.tsx, components/**/*.tsx, lib/**/*.ts, actions/**/*.ts
alwaysApply: true
---

# Sistema de Control de Gas - Reglas Cr√≠ticas

## üèóÔ∏è **Arquitectura del Sistema**

### **Roles y Acceso Diferenciado**

- **üë®‚Äçüíº JEFE (Admin)**: Acceso completo desde PC/tablet/m√≥vil

  - Panel "En Ruta" para monitoreo en tiempo real
  - Gesti√≥n completa de inventario
  - Configuraci√≥n de precios personalizados
  - Registro de llegadas de cami√≥n
  - Todos los reportes y an√°lisis

- **üë®‚Äçüíª VENDEDOR**: Solo acceso m√≥vil con funciones limitadas
  - Registro de ventas √∫nicamente
  - Registro de gastos operativos
  - Visualizaci√≥n solo de sus propias transacciones
  - Sin acceso a inventario general
  - Sin acceso a reportes financieros

### **Inventario Separado - CR√çTICO**

```typescript
// ‚úÖ DO: Manejar inventarios completamente separados
const inventoryFull = {
  type: '33lb' | '40lb' | '100lb', // Solo marca Roscogas
  quantity: number,
  unitCost: decimal,
};

const inventoryEmpty = {
  type: '33lb' | '40lb' | '100lb',
  brand: 'Roscogas' | 'Gasan' | 'Gaspais' | 'Vidagas' | 'Otro',
  color: 'Naranja' | 'Azul' | 'Verde Oscuro' | 'Verde Claro', // Se asigna autom√°ticamente seg√∫n la marca
  quantity: number,
};
```

### **Marcas y Colores de Cilindros - OBLIGATORIO**

```typescript
// ‚úÖ DO: Usar estas marcas y colores exactos
const cylinderBrands = {
  'Roscogas': 'Naranja', // Marca principal, color naranja
  'Gasan': 'Azul', // Marca secundaria, color azul
  'Gaspais': 'Verde Oscuro', // Marca secundaria, color verde oscuro
  'Vidagas': 'Verde Claro', // Marca secundaria, color verde claro
};

// ‚úÖ DO: Solo Roscogas para cilindros llenos
const fullCylinders = {
  brand: 'Roscogas',
  color: 'Naranja',
  types: ['33lb', '40lb', '100lb'],
};

// ‚úÖ DO: Todas las marcas para cilindros vac√≠os (color se asigna autom√°ticamente)
const emptyCylinders = {
  brands: ['Roscogas', 'Gasan', 'Gaspais', 'Vidagas'],
  // Color se asigna autom√°ticamente seg√∫n la marca seleccionada
  brandToColor: {
    'Roscogas': 'Naranja',
    'Gasan': 'Azul',
    'Gaspais': 'Verde Oscuro',
    'Vidagas': 'Verde Claro',
  },
};
```

### **Tipos de Transacciones - OBLIGATORIO**

```typescript
// ‚úÖ DO: Implementar estos 4 tipos exactos
type SaleType =
  | 'intercambio' // -1 lleno, +1 vac√≠o (80% de ventas)
  | 'completa' // -1 lleno √∫nicamente
  | 'venta_vacios' // -1 vac√≠o
  | 'compra_vacios'; // +1 vac√≠o
```

## üõ£Ô∏è **Panel "En Ruta" - Funcionalidad Central**

### **Cards de Vendedores - SOLO D√çA ACTUAL**

```typescript
// ‚úÖ DO: Mostrar √∫nicamente datos del d√≠a actual
interface VendorCard {
  vendorName: string;
  assignedRoute: string;
  cylindersAssigned: number; // Por tipo
  cylindersSold: number; // Por tipo
  cylindersRemaining: number; // Por tipo
  totalSales: number; // Del d√≠a
  totalExpenses: number; // Del d√≠a
  dailyMargin: number; // Ventas - Gastos
  progressPercentage: number; // Visual
  lastUpdate: timestamp;
}
```

### **Estados de Cilindros**

```typescript
// ‚úÖ DO: Usar estado STANDBY para asignaciones
type CylinderStatus =
  | 'available' // En inventario general
  | 'standby' // Asignado a vendedor (no afecta inventario)
  | 'sold' // Vendido (actualiza inventario)
  | 'returned'; // Devuelto al final del d√≠a
```

## üí∞ **Gesti√≥n Financiera - Factor Cr√≠tico**

### **Precio de Compra = Rentabilidad**

```typescript
// ‚úÖ DO: El precio de compra determina la ganancia
interface TruckArrival {
  cylindersReceived: number;
  unitCost: decimal; // CR√çTICO: Define rentabilidad
  totalInvoice: decimal;
  freightCost: decimal; // Se paga por separado
}
```

### **C√°lculo de Margen**

```typescript
// ‚úÖ DO: Calcular margen correctamente
const dailyMargin = totalSales - totalExpenses;
const profitPerCylinder = salePrice - purchasePrice;
```

## üì± **Interfaz M√≥vil - Vendedores**

### **Formulario de Ventas - Campos Obligatorios**

```typescript
// ‚úÖ DO: Incluir todos estos campos
interface SaleForm {
  customerName: string; // Obligatorio
  customerPhone?: string; // Opcional
  customerLocation: string; // Obligatorio
  productType: '33lb' | '40lb' | '100lb';
  saleType: SaleType;
  amountCharged: decimal;
  paymentMethod: 'efectivo' | 'transferencia' | 'credito';
  timestamp: Date; // Autom√°tico
}
```

### **Formulario de Gastos**

```typescript
// ‚úÖ DO: Categorizar gastos correctamente
interface ExpenseForm {
  type: 'gasolina' | 'comida' | 'reparaciones' | 'otros';
  amount: decimal;
  description: string;
  timestamp: Date;
}
```

## üîÑ **Flujo Operativo Diario**

### **Inicio del D√≠a (6:00 AM - 8:00 AM)**

1. Jefe asigna cilindros a vendedores
2. Cilindros quedan en estado STANDBY
3. Se crean cards "En Ruta" autom√°ticamente

### **Durante el D√≠a (8:00 AM - 6:00 PM)**

1. Vendedores registran ventas desde m√≥vil
2. Cards "En Ruta" se actualizan instant√°neamente
3. Inventario se actualiza solo con ventas confirmadas

### **Final del D√≠a (6:00 PM - 8:00 PM)**

1. Cilindros no vendidos regresan al inventario
2. Cards "En Ruta" se resetean autom√°ticamente
3. Datos se consolidan para reportes

## üö® **Reglas de Validaci√≥n**

### **‚ùå DON'T: Operaciones que NO afectan inventario**

- Salida para ruta (solo cambia a STANDBY)
- Asignaci√≥n a vendedores (solo crea cards)
- Devoluciones al final del d√≠a (solo cambia estado)

### **‚úÖ DO: Operaciones que S√ç afectan inventario**

- Venta con intercambio: -1 lleno, +1 vac√≠o
- Venta completa: -1 lleno
- Venta de vac√≠os: -1 vac√≠o
- Compra de vac√≠os: +1 vac√≠o
- Llegada de cami√≥n: +llenos recibidos, -vac√≠os entregados

## üìä **Sistema de Metas**

### **Unidad de Medida: Kilogramos**

```typescript
// ‚úÖ DO: Convertir autom√°ticamente
const conversions = {
  '33lb': 15, // kg
  '40lb': 18, // kg
  '100lb': 45, // kg
};
```

### **Per√≠odos de Metas**

- Semanales, mensuales, semestrales, anuales
- Generales del negocio e individuales por vendedor
- Seguimiento en tiempo real con barras de progreso

## üîê **Seguridad y Permisos**

### **Control de Edici√≥n**

- Vendedores solo pueden editar con autorizaci√≥n del jefe
- Sistema de solicitudes y aprobaciones
- Auditor√≠a completa de todas las acciones

### **Comunicaci√≥n Externa**

- WhatsApp para comprobantes y evidencias
- Sin integraci√≥n t√©cnica compleja
- Flujo directo jefe-vendedores

## üéØ **Objetivo Principal del Sistema**

**Maximizar la rentabilidad** controlando precisamente:

1. **Precio de compra** del gas (factor principal de costos)
2. **Precio de venta** al cliente (personalizable por cliente)
3. **Gastos operativos** (controlados por vendedor)

El sistema debe transformar datos operativos en **informaci√≥n accionable** para tomar mejores decisiones comerciales y operativas.
